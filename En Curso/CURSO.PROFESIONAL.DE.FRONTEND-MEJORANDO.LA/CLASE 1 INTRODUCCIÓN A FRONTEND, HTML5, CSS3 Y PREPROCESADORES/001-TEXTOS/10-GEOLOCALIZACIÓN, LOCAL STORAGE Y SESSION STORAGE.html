<html>
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1" name="viewport">

    
    
        <title>Cursos online de Mejorando.la</title>
    


    
    
        <link href="https://cursos.mejorando.la/media/favicons/mejorandola_fanpage_1.jpg" rel="shortcut icon">
    

    <link type="text/css" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,800italic,400,300,600">
    <link href="https://cursos.mejorando.la/static/css/platzi-base.css?v=2.1" rel="stylesheet">

    <script type="text/javascript" async="" src="https://ssl.google-analytics.com/ga.js"></script><script src="https://cursos.mejorando.la//ajax.googleapis.com/ajax/libs/jquery/1.10.0/jquery.min.js"></script>

    
        <script type="text/javascript" src="https://cursos.mejorando.la/static/js/vendors/socket.io.js"></script>
        <script type="text/javascript">
            window.nodeServer = "https://live.platzi.com/";
        </script>
    
    
<link href="https://cursos.mejorando.la/static/organizations/css/platzi-timeline.css?v=3.0" rel="stylesheet">


<style type="text/css"></style></head>

<body class="prettify-desert">

<div class="material-container">

        <div class="material-content">
            <h1>GEOLOCALIZACIÓN, LOCAL STORAGE Y SESSION STORAGE</h1>
            <h2>Geolocalización</h2><span><br>Cada cosa que haces en Internet deja una huella. &nbsp;&nbsp;Me gusta llamar a esto un tracking digital que de ser aprovechado en una comunidad es la mejor forma de generar contenido único.<br><br>Si analizas los principales proyectos frecuentes en la web y la forma como aportas a su comunidad, detectarás que hay un posible tracking que ayuda a que grandes bases de datos se conviertan en páginas de contenido.<br><br>Detectar la ubicación exacta de un usuario te ayuda a personalizar su experiencia, a ofrecerle publicidad mucho mejor segmentada y a dejarle pistas junto a ese rastro digital que está generando. &nbsp;Y la geolocalización no depende de tener un GPS, no depende únicamente de un teléfono móvil, los navegadores han ido implementando esta capacidad con plugins y diversos proyectos nativos, hasta que HTML5 lo adoptó como una de sus opciones.<br><br>Con esta capacidad, el navegador hace uso de muchos métodos (GPS, Skyhook, Google Geo, IP) para darte la latitud y longitud de quien lo utiliza. Obviamente, requiere inicialmente el permiso del usuario para proceder. &nbsp;Y lo mejor es que funciona en cualquier PC, no sólo en teléfonos.&nbsp;<br><br></span>Pero, ¿cómo&nbsp;lograría&nbsp;geo-localizarme en un portátil en donde no tengo GPS?, Muy fácil, resulta que los carros de google streetview, los smartphones con Android, IOS y Windows phone tienen una función la cual se encarga de recoger datos de las redes Wi-Fi disponibles en el lugar que se encuentren y mandarlas a una base de datos con la geolocalización respectiva, luego cuando la api de HTML5 solicita permiso para compartir la ubicación, recoge las redes Wi-Fi disponibles en tu laptop y las compara con las bases de datos del servidor (Donde previamente se habían geolocalizado los Routers&nbsp;Wi-Fi) y finalmente termina lanzando tu ubicación actual con un radio de 100 metros.<br><br><h3>Ahora vamos al código</h3><span><pre class="prettyprint prettyprinted" style=""><span class="pln">      </span><span class="tag">&lt;script</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"text/javascript"</span><span class="tag">&gt;</span><br><span class="pln">      </span><span class="kwd">var</span><span class="pln"> lat</span><span class="pun">,</span><span class="pln"> lon</span><span class="pun">,</span><span class="pln"> velocidad</span><span class="pun">,</span><span class="pln"> vector</span><span class="pun">;</span><br><span class="pln">      $</span><span class="pun">(</span><span class="pln">document</span><span class="pun">).</span><span class="pln">on</span><span class="pun">(</span><span class="str">"ready"</span><span class="pun">,</span><span class="pln"> inicio</span><span class="pun">);</span><br><span class="pln">      </span><span class="kwd">function</span><span class="pln"> inicio</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><br><span class="pln">              geolocalizar</span><span class="pun">();</span><br><span class="pln">      </span><span class="pun">}</span><br><span class="pln">      </span><span class="kwd">function</span><span class="pln"> geolocalizar</span><span class="pun">(){</span><br><span class="pln">              navigator</span><span class="pun">.</span><span class="pln">geolocation</span><span class="pun">.</span><span class="pln">getCurrentPosition</span><span class="pun">(</span><span class="pln">mostrar</span><span class="pun">,</span><span class="pln"> </span><span class="typ">CorrerEnCirculos</span><span class="pun">);</span><br><span class="pln">      </span><span class="pun">}</span><br><span class="pln">      </span><span class="kwd">function</span><span class="pln"> </span><span class="typ">CorrerEnCirculos</span><span class="pun">(</span><span class="pln">errorsh</span><span class="pun">){</span><br><span class="pln">              alert</span><span class="pun">(</span><span class="str">"Te encontrare muy pronto"</span><span class="pun">)</span><br><span class="pln">              console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="pln">errorsh</span><span class="pun">)</span><br><span class="pln">      </span><span class="pun">}</span><br><span class="pln">      </span><span class="kwd">function</span><span class="pln"> mostrar</span><span class="pun">(</span><span class="pln">geo</span><span class="pun">){</span><br><span class="pln">              lat             </span><span class="pun">=</span><span class="pln"> geo</span><span class="pun">.</span><span class="pln">coords</span><span class="pun">.</span><span class="pln">latitude</span><span class="pun">;</span><br><span class="pln">              lon             </span><span class="pun">=</span><span class="pln"> geo</span><span class="pun">.</span><span class="pln">coords</span><span class="pun">.</span><span class="pln">longitude</span><span class="pun">;</span><br><span class="pln">              velocidad       </span><span class="pun">=</span><span class="pln"> geo</span><span class="pun">.</span><span class="pln">coords</span><span class="pun">.</span><span class="pln">speed</span><span class="pun">;</span><br><span class="pln">              vector          </span><span class="pun">=</span><span class="pln"> geo</span><span class="pun">.</span><span class="pln">coords</span><span class="pun">.</span><span class="pln">heading</span><span class="pun">;</span><br><span class="pln">              document</span><span class="pun">.</span><span class="pln">write </span><span class="pun">(</span><span class="str">'Latitud: '</span><span class="pun">,</span><span class="pln"> lat</span><span class="pun">,</span><span class="pln"> </span><span class="str">"&lt;br /&gt;"</span><span class="pun">);</span><br><span class="pln">              document</span><span class="pun">.</span><span class="pln">write </span><span class="pun">(</span><span class="str">'Longitud: '</span><span class="pun">,</span><span class="pln"> lon</span><span class="pun">,</span><span class="pln"> </span><span class="str">"&lt;br /&gt;"</span><span class="pun">);</span><br><span class="pln">              document</span><span class="pun">.</span><span class="pln">write </span><span class="pun">(</span><span class="str">'Velocidad: '</span><span class="pun">,</span><span class="pln"> velocidad</span><span class="pun">,</span><span class="pln"> </span><span class="str">"&lt;br /&gt;"</span><span class="pun">);</span><br><span class="pln">              document</span><span class="pun">.</span><span class="pln">write </span><span class="pun">(</span><span class="str">'Vector: '</span><span class="pun">,</span><span class="pln"> vector</span><span class="pun">);</span><br><span class="pln">      </span><span class="pun">}</span><br><span class="pln">      </span><span class="tag">&lt;/script&gt;</span></pre><br>Este es el código del JavaScript para obtener la latitud, longitud, velocidad (e.j: 30Km/h) y Vector (e.j: 30ºN) del dispositivo a rastrear. Básicamente la linea de código que nos da la localización seria:<br><br><pre class="prettyprint prettyprinted" style=""><span class="pln">      </span><span class="kwd">function</span><span class="pln"> geolocalizar</span><span class="pun">(){</span><br><span class="pln">              navigator</span><span class="pun">.</span><span class="pln">geolocation</span><span class="pun">.</span><span class="pln">getCurrentPosition</span><span class="pun">(</span><span class="pln">mostrar</span><span class="pun">,</span><span class="pln"> </span><span class="typ">CorrerEnCirculos</span><span class="pun">);</span><br><span class="pln">      </span><span class="pun">}</span></pre><br>La cual nos arrojara dos casos, el primero en donde todo sale bien y obtenemos las coordenadas, velocidad y vector del dispositivo y las guardamos y mostramos en la función mostrar:<br><br><pre class="prettyprint prettyprinted" style=""><span class="pln">      </span><span class="kwd">function</span><span class="pln"> mostrar</span><span class="pun">(</span><span class="pln">geo</span><span class="pun">){</span><br><span class="pln">              lat             </span><span class="pun">=</span><span class="pln"> geo</span><span class="pun">.</span><span class="pln">coords</span><span class="pun">.</span><span class="pln">latitude</span><span class="pun">;</span><br><span class="pln">              lon             </span><span class="pun">=</span><span class="pln"> geo</span><span class="pun">.</span><span class="pln">coords</span><span class="pun">.</span><span class="pln">longitude</span><span class="pun">;</span><br><span class="pln">              velocidad       </span><span class="pun">=</span><span class="pln"> geo</span><span class="pun">.</span><span class="pln">coords</span><span class="pun">.</span><span class="pln">speed</span><span class="pun">;</span><br><span class="pln">              vector          </span><span class="pun">=</span><span class="pln"> geo</span><span class="pun">.</span><span class="pln">coords</span><span class="pun">.</span><span class="pln">heading</span><span class="pun">;</span><br><span class="pln">              document</span><span class="pun">.</span><span class="pln">write </span><span class="pun">(</span><span class="str">'Latitud: '</span><span class="pun">,</span><span class="pln"> lat</span><span class="pun">,</span><span class="pln"> </span><span class="str">"&lt;br /&gt;"</span><span class="pun">);</span><br><span class="pln">              document</span><span class="pun">.</span><span class="pln">write </span><span class="pun">(</span><span class="str">'Longitud: '</span><span class="pun">,</span><span class="pln"> lon</span><span class="pun">,</span><span class="pln"> </span><span class="str">"&lt;br /&gt;"</span><span class="pun">);</span><br><span class="pln">              document</span><span class="pun">.</span><span class="pln">write </span><span class="pun">(</span><span class="str">'Velocidad: '</span><span class="pun">,</span><span class="pln"> velocidad</span><span class="pun">,</span><span class="pln"> </span><span class="str">"&lt;br /&gt;"</span><span class="pun">);</span><br><span class="pln">              document</span><span class="pun">.</span><span class="pln">write </span><span class="pun">(</span><span class="str">'Vector: '</span><span class="pun">,</span><span class="pln"> vector</span><span class="pun">);</span><br><span class="pln">      </span><span class="pun">}</span></pre><br>Y tenemos el segundo caso es en donde el usuario no nos da permiso de compartir su ubicación y no obtenemos los datos imprimiendo en la consola el error en la función CorrerEnCirculos:<br><br><pre class="prettyprint prettyprinted" style=""><span class="pln">      </span><span class="kwd">function</span><span class="pln"> </span><span class="typ">CorrerEnCirculos</span><span class="pun">(</span><span class="pln">errorsh</span><span class="pun">){</span><br><span class="pln">              alert</span><span class="pun">(</span><span class="str">"Localizacion no permitida"</span><span class="pun">)</span><br><span class="pln">              console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="pln">errorsh</span><span class="pun">)</span><br><span class="pln">      </span><span class="pun">}</span></pre></span><span><br>Demo: <a href="http://html5demos.com/geo" target="_blank" rel="nofollow">html5demos</a><br><a href="http://www.youtube.com/watch?v=wHCelLN3lTI" target="_blank" rel="nofollow">Mejorando.la nos hablo sobre esto.</a><br><br></span><h2>Local Storage y Session Storage</h2><span><br>Cuando la web nació hace muchos muchos años de la mano de Tim Bernes Lee, nació como una mera transacción electrónica entre un cliente y un servidor: el cliente solicita un recurso, el servidor ofrece una respuesta. Listo, no hay más magia que esto. Para el servidor, una petición es indistinta de otra inmediata, y el ciclo comienza nuevamente. Es por esto que se dice que el protocolo HTTP no tiene estado, o sea, es stateless. Es nuestra responsabilidad como desarrolladores solventar esta limitación y asegurarnos de mantener el estado entre peticiones.<br><br>Para esta tarea, era muy habitual utilizar cookies, estos pequeños pedacitos de información que viajan en cada petición entre el cliente y el servidor, de manera de recordarle "Hey! ¿te acuerdas de mi?". Entonces, si tenemos el problema resuelto, ¿para qué necesitamos otro método nuevo? Bueno, resulta que las cookies no son tan buena solución:<br><br>Aumentan el peso de cada petición al servidor, ya que toda la información guardada en las cookies debe viajar al servidor, y volver.Tienen una limitación de 4kb de espacio disponible.No todo el mundo tiene las cookies habilitadas, sobre todo luego de que se publicaran como ciertas empresas utilizan las cookies para registrar nuestro comportamiento en la web.<br>Por suerte, una de las nuevas específicaciones de la W3C y WHATWG, indica como podemos utilizar Javascript para guardar información en los navegadores de nuestros usuarios que expire al finalizar la sesión, o que no expire en lo absoluto a menos que el usuario lo indique.<br>Entran a la cancha localStorage y sessionStorage¿Qué son localStorage y sessionStorage? Puesto de manera sencilla, son dos métodos que nos ofrecen los navegadores para guardar pares de valores llave/valor, de manera sencilla y dándonos de manera standard unos 5 megabytes. Al igual que las cookies, esta información no desaparece si uno navega fuera de la página. Al contrario de las cookies, esta información queda guardada en la computadora del cliente, y no viaja con cada petición.&nbsp;<br><br>No hay excusas para no utilizar ninguno de los dos métodos, ya que se encuentran soportados por prácticamente todos los navegadores, excepto OldIE y Safari 3.2.<br><br></span><h3>Comenzar a utilizarlo es muy sencillo:</h3><br><pre class="prettyprint prettyprinted" style=""><span><span class="com">/* Utilizando la Api de Local Storage, podemos</span><br></span><span><span class="com"> &nbsp;&nbsp;guardar y luego recuperar un valor */</span><span class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br></span><span><span class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br></span><span><span class="pln">localStorage</span><span class="pun">.</span><span class="pln">setItem</span><span class="pun">(</span><span class="str">'saludo'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Bienvenidos a localStorage'</span><span class="pun">);</span><br></span><span class="pln">valor </span><span class="pun">=</span><span class="pln"> localStorage</span><span class="pun">.</span><span class="pln">getItem</span><span class="pun">(</span><span class="str">'saludo'</span><span class="pun">);</span><br><span><span class="com">/* Pero esta no es la única manera, ya que</span><br></span><span><span class="com"> &nbsp;&nbsp;también podemos hacer lo siguiente */</span><br></span><span><span class="pln"> &nbsp;&nbsp;</span><br></span><span><span class="pln">localStorage</span><span class="pun">[</span><span class="str">'saludo'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Este saludo también es válido'</span><span class="pun">;</span><br></span><span class="pln">valor </span><span class="pun">=</span><span class="pln"> localStorage</span><span class="pun">[</span><span class="str">'saludo'</span><span class="pun">];</span><br><span class="com">/* Y claro, esto también es válido */</span><br><span><span class="pln">localStorage</span><span class="pun">.</span><span class="pln">saludo </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Y este es mi método favorito'</span><span class="pun">;</span><br></span><span class="pln">valor </span><span class="pun">=</span><span class="pln"> localStorage</span><span class="pun">.</span><span class="pln">saludo</span><span class="pun">;</span></pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>Pero esto no es lo único que podemos hacer, ya que las APIs de Local Storage como la de Session Storage nos ofrecen un par de métodos más para controlar la información que contienen.<br><br><pre class="prettyprint prettyprinted" style=""><span class="com">/* Podemos saber cuántos elementos tenemos guardados */</span><br><span class="pln">alert</span><span class="pun">(</span><span class="str">'Tenemos '</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> localStorage</span><span class="pun">.</span><span class="pln">length </span><span class="pun">+</span><span class="pln"> </span><span class="str">' elementos dentro de Local Storage'</span><span class="pun">);</span><br><span class="com">/* Eliminar elementos también es muy sencillo de lograr */</span><br><span class="pln">localStorage</span><span class="pun">.</span><span class="pln">removeItem</span><span class="pun">(</span><span class="str">'saludo'</span><span class="pun">);</span><br><span><span class="com">/* Y si queremos acceder a la información de localStorage</span><br></span><span><span class="com"> &nbsp;&nbsp;de manera secuencial, entonces lo podemos hacer gracias</span><br></span><span><span class="com"> &nbsp;&nbsp;a su método 'key' que devuelve la clave en determinada posición */</span><br></span><span><span class="pln"> &nbsp;&nbsp;</span><br></span><span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> t</span><span class="pun">=</span><span class="pln">localStorage</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><br></span><span><span class="pln"> &nbsp;&nbsp;&nbsp;key </span><span class="pun">=</span><span class="pln"> localStorage</span><span class="pun">.</span><span class="pln">key</span><span class="pun">(</span><span class="pln">i</span><span class="pun">);</span><br></span><span><span class="pln"> &nbsp;&nbsp;&nbsp;alert</span><span class="pun">(</span><span class="str">'Para la clave '</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> key </span><span class="pun">+</span><span class="pln"> </span><span class="str">' el valor es: '</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> localStorage</span><span class="pun">[</span><span class="pln">key</span><span class="pun">]);</span><br></span><span class="pun">}</span></pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>Vale aclarar que todo lo mismo vale en este punto, si queremos trabajar con sessionStorage, que guardará los valores durante el tiempo de session del navegador, y se borrarán cuando el navegador se reinicie. Esto no sucede con localStorage, que conservará los valores aunque cerremos y volvamos a acceder al navegador.<br><br>Cómo cargar local Storage de manera más inteligente.<br>Luego de estar trabajando un tiempo con localStorage o sessionStorage, comienza a notarse un patrón cuando queremos asegurarnos de la disponibilidad del Storage. Al comienzo hacemos las siguientes pruebas:<br><br><pre class="prettyprint prettyprinted" style=""><span><span class="kwd">if</span><span class="pun">(</span><span class="str">'localStorage'</span><span class="pln"> </span><span class="kwd">in</span><span class="pln"> window </span><span class="pun">&amp;&amp;</span><span class="pln"> window</span><span class="pun">[</span><span class="str">'localStorage'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!==</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><br></span><span><span class="pln"> &nbsp;&nbsp;&nbsp;alert</span><span class="pun">(</span><span class="str">'Genial, tenemos un navegador decente que soporta LocalStorage);</span><br></span><span><span class="str"> &nbsp;&nbsp;&nbsp;var storage = localStorage</span><br></span><span><span class="str">} else {</span><br></span><span><span class="str"> &nbsp;&nbsp;&nbsp;alert('</span><span class="typ">Como</span><span class="pln"> seguimos utilizando un navegador viejo</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Santa</span><span class="pln"> </span><span class="typ">Claus</span><span class="pln"> </span><span class="kwd">no</span><span class="pln"> nos traer</span><span class="pun">á</span><span class="pln"> nada esta </span><span class="typ">Navidad</span><span class="str">');</span><br></span><span class="str">}</span></pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>Como puden ver, el utilizar el "if" para chequear la existencia de localStorage se puede volver un tanto molesto y un "anti-patrón". ¿Y qué pasa si no tenemos soporte para localStorage? ¿Nuestra aplicación debe fallar? ¿O deberíamos ofrecer una solución que degrade de manera "grácil"?<br><br>Aquí es donde surge la necesidad de trabajar con un método que sirva ya en tanto tengamos soporte, o no. Y que no de errores al momento de chequear la disponibilidad de localStorage. Este es el código que estoy utilizando en mis desarrollos:<br><br><pre class="prettyprint prettyprinted" style=""><span><span class="com">// Existe localStorage? </span><br></span><span><span class="kwd">var</span><span class="pln"> storage</span><span class="pun">;</span><br></span><span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><br></span><span><span class="pln"> &nbsp;&nbsp;&nbsp;</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">localStorage</span><span class="pun">.</span><span class="pln">getItem</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><br></span><span><span class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;storage </span><span class="pun">=</span><span class="pln"> localStorage</span><span class="pun">;</span><br></span><span><span class="pln"> &nbsp;&nbsp;&nbsp;</span><span class="pun">}</span><br></span><span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pun">(</span><span class="pln">e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><br></span><span><span class="pln"> &nbsp;&nbsp;&nbsp;storage </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{};</span><br></span><span class="pun">}</span></pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>De esta manera, dentro de la variable storage tendremos o una referencia a localStorage lista para utilizar, o un objeto que no reemplazará la funcionalidad de localStorage, pero al menos no dará error inmediatamente cuando lo utilicemos, para luego implementar alguna librería que de soporte, como&nbsp;<a href="http://amplifyjs.com/" target="_blank" rel="nofollow">Amplify.js</a>.<br><br><h3>No Strings Attached</h3><br>Una de las limitantes más molestas de localStorage y sessionStorage es que, al igual que con las cookies, solo podemos guardar cadenas de texto. Nada de valores nativos como enteros, float, ni siquiera un triste boolean (que sería "false"). Ni hablar de los objetos:<br><br><pre class="prettyprint prettyprinted" style=""><span><span class="pln">persona </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">nombre</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Pablo Rigazzi'</span><span class="pun">,</span><span class="pln"> edad</span><span class="pun">:</span><span class="pln"> </span><span class="lit">33</span><span class="pun">};</span><br></span><pre class="prettyprint"><span><span class="pln">localStorage</span><span class="pun">.</span><span class="pln">autor </span><span class="pun">=</span><span class="pln"> persona</span><span class="pun">;</span><br></span><span><span class="pln">alert</span><span class="pun">(</span><span class="pln">localStorage</span><span class="pun">.</span><span class="pln">autor</span><span class="pun">);</span><br></span><span><span class="com">// Esto nos devuelve el texto </span><br></span><span class="str">"[object Object]"</span></pre></pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>Entonces, ¿Cómo podemos hacer para superar esta limitante? Afortunadamente, hay una técnica bastante simple para guardar objetos completos dentro de localStorage, para luego recuperarlos y volver a convertirlos, y este método es utilizar el objeto JSON, disponible en los mismos navegadores que soportan localStorage. Retomando el ejemplo anterior:<br><br><pre class="prettyprint prettyprinted" style=""><span class="com">// Primero convertimos el objeto en una cadena de texto</span><br><pre class="prettyprint"><span><span class="pln">localStorage</span><span class="pun">.</span><span class="pln">autor </span><span class="pun">=</span><span class="pln"> JSON</span><span class="pun">.</span><span class="pln">stringify</span><span class="pun">(</span><span class="pln">persona</span><span class="pun">);</span><br></span><span><span class="com">/* Y ahora, al recuperarlo, convertimos el string </span><br></span><span><span class="com"> &nbsp;&nbsp;nuevamente en un objeto */</span><br></span><span><span class="kwd">var</span><span class="pln"> autor </span><span class="pun">=</span><span class="pln"> JSON</span><span class="pun">.</span><span class="pln">parse</span><span class="pun">(</span><span class="pln">localStorage</span><span class="pun">.</span><span class="pln">autor</span><span class="pun">);</span><br></span><span><span class="pln">alert</span><span class="pun">(</span><span class="kwd">typeof</span><span class="pln"> autor</span><span class="pun">);</span><br></span><span><span class="com">// Aqui obtendremos que el tipo de la variable es "object"</span><br></span><span class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre></pre><br><h3>Vientos de cambio</h3>Los navegadores nos dan un mecanismo para enterarnos cuando otra página realizó cambios sobre los valores de localStorage (y solo localStorage). Para esto, lanzan un evento llamado "storage" que es muy fácilmente atrapable. Lo malo, no es un evento "cancelable", esto es, el navegador solamente nos avisa del cambio, pero no tenemos manera de impedir que ese cambio se realice. Hay que tener en cuenta que este evento se dispara si el cambio se realizó en otra página (abierta en otra ventana o en otro tab), que esté asociada al mismo localStorage con el que estamos trabajando (o sea, es del mismo dominio).<br><br><pre class="prettyprint prettyprinted" style=""><span><span class="pln">hay_cambio </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><br></span><span><span class="pln"> &nbsp;&nbsp;&nbsp;console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">"Dentro de la clave "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> e</span><span class="pun">.</span><span class="pln">key </span><span class="pun">+</span><span class="pln"> </span><span class="str">" el valor anterior era "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> e</span><span class="pun">.</span><span class="pln">oldValue </span><span class="pun">+</span><span class="pln"> </span><span class="str">' y el nuevo es '</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> e</span><span class="pun">.</span><span class="pln">newValue</span><span class="pun">);</span><br></span><span><span class="pun">}</span><br></span><span><span class="kwd">if</span><span class="pun">(</span><span class="pln">window</span><span class="pun">.</span><span class="pln">addEventListener</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><br></span><span><span class="pln"> &nbsp;&nbsp;&nbsp;window</span><span class="pun">.</span><span class="pln">addEventListener</span><span class="pun">(</span><span class="str">'storage'</span><span class="pun">,</span><span class="pln"> hay_cambio</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">);</span><br></span><span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><br></span><span><span class="pln"> &nbsp;&nbsp;&nbsp;</span><span class="com">// Hay que soportar IE6, 7 y 8, lo lamento :P</span><br></span><span><span class="pln"> &nbsp;&nbsp;&nbsp;window</span><span class="pun">.</span><span class="pln">attachEvent</span><span class="pun">(</span><span class="str">'onstorage'</span><span class="pun">,</span><span class="pln"> hay_cambio</span><span class="pun">);</span><br></span><span class="pun">}</span></pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>Aquí es donde para probar, podemos abrir otra ventana del mismo dominio donde estemos trabajando, disparar FireBug o la consola de Chrome, y tipear: localStorage.clave = "nuevo valor.", y ver como se dispara el evento en el tab o ventana original.<br><br><h3>¿Qué ejemplos para utilizar Session Storage y Local Storage se nos ocurren?</h3><br>Guardar resultados temporalmente de una llamada a un webservice.<br>Mantener estado de la interfaz de usuario de manera sencilla.Referencias<br><br><span><a href="http://coding.smashingmagazine.com/2010/10/11/local-storage-and-how-to-use-it/" target="_blank" rel="nofollow">SmashingMagazine</a><br><a href="http://paperkilledrock.com/2010/05/html5-localstorage-part-one/" target="_blank" rel="nofollow">Paper Killed Rock</a><br><a href="http://www.w3.org/TR/webstorage/" target="_blank" rel="nofollow">W3C</a><br><a href="http://diveintohtml5.info/storage.html" target="_blank" rel="nofollow">Dive Into HTML5</a></span>
            
        </div>
    </div>
</body>
</html>